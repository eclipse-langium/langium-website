<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Langium showcase</title>
    <style>
        html, body, #monaco-editor-root {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="monaco-editor-root"></div>

    <script type="module">
        import { MonacoEditorLanguageClientWrapper } from '../libs/monaco-editor-comp/index.js';
        import { buildWorkerDefinition } from "../libs/monaco-editor-workers/index.js";
        //import { MonacoEditorLanguageClientWrapper } from 'monaco-editor-comp';
        //import { buildWorkerDefinition } from "monaco-editor-workers";

        buildWorkerDefinition('../libs/monaco-editor-workers/workers', import.meta.url, false);

        MonacoEditorLanguageClientWrapper.addMonacoStyles('monaco-editor-styles');
        MonacoEditorLanguageClientWrapper.addCodiconTtf();

        const client = new MonacoEditorLanguageClientWrapper(42);
        const editorConfig = client.getEditorConfig();
        editorConfig.setMainLanguageId('statemachine');
        editorConfig.setMainCode(`
statemachine TrafficLight

events
    switchCapacity
    next

initialState PowerOff

state PowerOff
    switchCapacity => RedLight
end

state RedLight
    switchCapacity => PowerOff
    next => GreenLight
end

state YellowLight
    switchCapacity => PowerOff
    next => RedLight
end

state GreenLight
    switchCapacity => PowerOff
    next => YellowLight
end
`);
        editorConfig.theme = 'vs-dark';

        editorConfig.useLanguageClient = true;
        //const workerURL = new URL(import.meta.env.DEV ? '../../src/serverWorker.ts' : '../libs/worker/serverWorker-es.js', import.meta.url);
        const workerURL = new URL('../libs/worker/serverWorker-es.js', import.meta.url);
        console.log(workerURL.href);
        editorConfig.lcConfigOptions = {
            useWebSocket: false,
            wsSecured: false,
            wsHost: "localhost",
            wsPort: "3000",
            wsPath: "sampleServer",
            workerURL: workerURL.href
        };

        client.startEditor(document.getElementById("monaco-editor-root"));

        window.addEventListener("resize", () => client.updateLayout());
    </script>
</body>

</html>
